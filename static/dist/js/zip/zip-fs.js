!function(){"use strict";var t,i,p=524288,r=zip.TextWriter,u=zip.BlobWriter,o=zip.Data64URIWriter,n=zip.Reader,e=zip.TextReader,f=zip.BlobReader,a=zip.Data64URIReader,c=zip.createReader,s=zip.createWriter;function d(o){var a,c=this;c.size=0,c.init=function(t){c.size=o.uncompressedSize,t()},c.readUint8Array=function(t,i,n,e){var r;r=function(){a.readUint8Array(t,i,n,e)},c.data?r():o.getData(new u,function(t){c.data=t,a=new f(t),r()},null,c.checkCrc32)}}function h(t){var n=0;return function t(i){n+=i.uncompressedSize||0,i.children.forEach(t)}(t),n}function l(t,i,n){var e=0;function r(){++e<t.children.length?o(t.children[e]):i()}function o(t){t.directory?l(t,r,n):(t.reader=new t.Reader(t.data,n),t.reader.init(function(){t.uncompressedSize=t.reader.size,r()}))}t.children.length?o(t.children[e]):i()}function y(n){var e=n.parent.children;e.forEach(function(t,i){t.id==n.id&&e.splice(i,1)})}function m(i,n,e,u){n.isDirectory?function a(c,t,n){!function(t,n){var e=[];if(t.isDirectory){var r=t.createReader();!function i(){r.readEntries(function(t){t.length?(e=e.concat(t),i()):n(e)},u)}()}t.isFile&&n(e)}(t,function(i){var r=0;function o(){var t=i[r];t?function(n){function e(t){a(t,n,function(){r++,o()})}n.isDirectory&&e(c.addDirectory(n.name)),n.isFile&&n.file(function(t){var i=c.addBlob(n.name,t);i.uncompressedSize=t.size,e(i)},u)}(t):n()}o()})}(i,n,e):n.file(function(t){i.addBlob(n.name,t),e()},u)}function g(t,i,n,e,r,o,s){var p=0;i.directory?function e(r,i,n,o,a,c){var u=0;function f(){var t=i.children[u];t?function(i){function n(t){p+=i.uncompressedSize||0,e(t,i,function(){u++,f()},o,a,c)}i.directory?r.getDirectory(i.name,{create:!0},n,a):r.getFile(i.name,{create:!0},function(t){i.getData(new zip.FileWriter(t,zip.getMimeType(i.name)),n,function(t){o&&o(p+t,c)},s)},a)}(t):n()}f()}(t,i,n,e,r,o):i.getData(new zip.FileWriter(t,zip.getMimeType(i.name)),n,e,s)}function z(t){t.entries=[],t.root=new x(t)}function v(t,i,n,e){if(t.directory)return e?new x(t.fs,i,n,t):new w(t.fs,i,n,t);throw"Parent entry is not a directory."}function D(){}function w(t,i,n,e){var r=this;D.prototype.init.call(r,t,i,n,e),r.Reader=n.Reader,r.Writer=n.Writer,r.data=n.data,n.getData&&(r.getData=n.getData)}function x(t,i,n,e){D.prototype.init.call(this,t,i,n,e),this.directory=!0}function R(){z(this)}((d.prototype=new n).constructor=d).prototype.checkCrc32=!1,w.prototype=t=new((D.prototype={init:function(t,i,n,e){var r=this;if(t.root&&e&&e.getChildByName(i))throw"Entry filename already exists.";n||(n={}),r.fs=t,r.name=i,r.id=t.entries.length,r.parent=e,r.children=[],r.zipVersion=n.zipVersion||20,r.uncompressedSize=0,t.entries.push(r),e&&r.parent.children.push(r)},getFileEntry:function(t,i,n,e,r){var o=this;l(o,function(){g(t,o,i,n,e,h(o),r)},e)},moveTo:function(t){var i=this;if(!t.directory)throw"Target entry is not a directory.";if(t.isDescendantOf(i))throw"Entry is a ancestor of target entry.";if(i!=t){if(t.getChildByName(i.name))throw"Entry filename already exists.";y(i),(i.parent=t).children.push(i)}},getFullname:function(){for(var t=this.name,i=this.parent;i;)t=(i.name?i.name+"/":"")+t,i=i.parent;return t},isDescendantOf:function(t){for(var i=this.parent;i&&i.id!=t.id;)i=i.parent;return!!i}}).constructor=D),t.constructor=w,t.getData=function(t,i,u,f){var s=this;!t||t.constructor==s.Writer&&s.data?i(s.data):(s.reader||(s.reader=new s.Reader(s.data,f)),s.reader.init(function(){t.init(function(){var n,e,r,o,a,c;n=s.reader,e=t,r=i,o=u,a=f,c=0,function i(){var t=c*p;o&&o(t,n.size),t<n.size?n.readUint8Array(t,Math.min(p,n.size-t),function(t){e.writeUint8Array(new Uint8Array(t),function(){c++,i()})},a):e.getData(r)}()},f)}))},t.getText=function(t,i,n,e){this.getData(new r(e),t,i,n)},t.getBlob=function(t,i,n,e){this.getData(new u(t),i,n,e)},t.getData64URI=function(t,i,n,e){this.getData(new o(t),i,n,e)},x.prototype=i=new D,i.constructor=x,i.addDirectory=function(t){return v(this,t,null,!0)},i.addText=function(t,i){return v(this,t,{data:i,Reader:e,Writer:r})},i.addBlob=function(t,i){return v(this,t,{data:i,Reader:f,Writer:u})},i.addData64URI=function(t,i){return v(this,t,{data:i,Reader:a,Writer:o})},i.addFileEntry=function(t,i,n){m(this,t,i,n)},i.addData=function(t,i){return v(this,t,i)},i.importBlob=function(t,i,n){this.importZip(new f(t),i,n)},i.importText=function(t,i,n){this.importZip(new e(t),i,n)},i.importData64URI=function(t,i,n){this.importZip(new a(t),i,n)},i.exportBlob=function(t,i,n){this.exportZip(new u("application/zip"),t,i,n)},i.exportText=function(t,i,n){this.exportZip(new r,t,i,n)},i.exportFileEntry=function(t,i,n,e){this.exportZip(new zip.FileWriter(t,"application/zip"),i,n,e)},i.exportData64URI=function(t,i,n){this.exportZip(new o("application/zip"),t,i,n)},i.importZip=function(t,i,n){var r=this;c(t,function(t){t.getEntries(function(t){t.forEach(function(t){var i=r,n=t.filename.split("/"),e=n.pop();n.forEach(function(t){i=i.getChildByName(t)||new x(r.fs,t,null,i)}),t.directory||v(i,e,{data:t,Reader:d})}),i()})},n)},i.exportZip=function(t,i,n,e){var r=this;l(r,function(){s(t,function(t){!function(t,i,n,e,r){var u=0;function f(n,e,r,o,a){var c=0;!function t(){var i=e.children[c];i?n.add(i.getFullname(),i.reader,function(){u+=i.uncompressedSize||0,f(n,i,function(){c++,t()},o,a)},function(t){o&&o(u+t,a)},{directory:i.directory,version:i.zipVersion}):r()}()}f(t,i,n,e,r)}(t,r,function(){t.close(i)},n,h(r))},e)},e)},i.getChildByName=function(t){var i,n;for(i=0;i<this.children.length;i++)if((n=this.children[i]).name==t)return n},R.prototype={remove:function(t){y(t),this.entries[t.id]=null},find:function(t){var i,n=t.split("/"),e=this.root;for(i=0;e&&i<n.length;i++)e=e.getChildByName(n[i]);return e},getById:function(t){return this.entries[t]},importBlob:function(t,i,n){z(this),this.root.importBlob(t,i,n)},importText:function(t,i,n){z(this),this.root.importText(t,i,n)},importData64URI:function(t,i,n){z(this),this.root.importData64URI(t,i,n)},exportBlob:function(t,i,n){this.root.exportBlob(t,i,n)},exportText:function(t,i,n){this.root.exportText(t,i,n)},exportFileEntry:function(t,i,n,e){this.root.exportFileEntry(t,i,n,e)},exportData64URI:function(t,i,n){this.root.exportData64URI(t,i,n)}},zip.fs={FS:R,ZipDirectoryEntry:x,ZipFileEntry:w},zip.getMimeType=function(){return"application/octet-stream"}}();